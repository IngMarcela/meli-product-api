version: 2.1

executors:
  go-executor:
    docker:
      - image: cimg/go:1.21 # UsÃ¡ tu versiÃ³n de Go
    working_directory: ~/repo

jobs:
  test:
    executor: go-executor
    steps:
      - checkout
      - run: go mod tidy
      - run: go test -coverprofile=coverage.out ./...
      - run: |
          echo "\nðŸ“Š Analizando cobertura de tests..."
          COVERAGE=$(go tool cover -func=coverage.out | grep total | awk '{print $3}' | sed 's/%//')
          if (( $(echo "$COVERAGE < 80" | bc -l) )); then
            echo "\nâŒ La cobertura de tests es menor al 80%"
            echo "ðŸ“ˆ Cobertura actual: ${COVERAGE}%"
            echo "ðŸŽ¯ Cobertura requerida: 80%"
            echo "\nðŸ’¡ Sugerencias:"
            echo "  - Agrega mÃ¡s tests unitarios"
            - Revisa los archivos sin cobertura
            exit 1
          fi
          echo "\nâœ… Cobertura de tests: ${COVERAGE}%"
          echo "ðŸŽ¯ Cobertura requerida: 80%"
          echo "\nâœ¨ Â¡Excelente trabajo! La cobertura de tests es adecuada."

workflows:
  test:
    jobs:
      - test
